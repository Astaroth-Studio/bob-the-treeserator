<!--This Document is generated by GameMaker, if you edit it by hand then you do so at your own risk!-->
<object>
  <spriteName>sBobIdle</spriteName>
  <solid>0</solid>
  <visible>-1</visible>
  <depth>0</depth>
  <persistent>0</persistent>
  <parentName>&lt;undefined&gt;</parentName>
  <maskName>&lt;undefined&gt;</maskName>
  <events>
    <event eventtype="0" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>global.stopTime = false;

BOB_SCALE = 2; // Change this number if you rescale Bob
isFighting = false;
isShooting = false;

defaultSpeed = 0.075;
image_speed = defaultSpeed;
walkSpeed = 0.075;
moveSpeed = 3000;
maxXSpeed = 4;

globalvar controls;
controls = true; // Desactivated when falling

phy_fixed_rotation = true;

global.bulletDamage = 15;
global.fistDamage = 35;
bulletSpeed = 15;
fullShootingCooldown = 400; // Cooldown in milliseconds
shootingCooldown = fullShootingCooldown; // Time changing each step 

recoveryTimeMaxCooldown = 1000;
recoveryTimeCooldown = recoveryTimeMaxCooldown;

maxJumps = 2;
jumpsLeft = maxJumps;
jumpPower = 500;

//Punch variables
inPunch = false;
inTruePunch = false;
maxStopTimer = 250;
stopTimer = maxStopTimer;
currentRandomX = 0;
currentX = 0;
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="3" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>oBob</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>// Parallax Effectâ„¢
background_x[1] =  view_xview[0] + (view_wview[0] * 0.3) + (( 1 - (view_xview[0] / room_width))) * (view_wview[0] * 0.4);
background_x[2] =  view_xview[0] * 0.7;
background_x[3] = (view_wview[0]-background_width[3]) * (view_xview[0]/(room_width-view_wview[0])) + view_xview[0];

/*-------[ Punching System ]-------*/
if(inPunch) {
    stopTimer = stopTimer-(delta_time/1000);
    
    if(inTruePunch) {
        progress=stopTimer/maxStopTimer;
        if(progress &lt;= 0.5) {
            view_xview[0] = currentX + (currentRandomX * (progress/0.5));
        } else {
            view_xview[0] = currentX;
        }
    }
    
    if(stopTimer &lt;= 0) {
        stopTimer = maxStopTimer;
        if(inTruePunch) {
            global.stopTime = false;
            physics_pause_enable(false);
            inTruePunch = false;
        }
        inPunch = false;
        isFighting = false;
    }
}

//Everything below this code will not be executed after stopTime has been set to true
if(global.stopTime) { image_speed = 0; exit; }

/*-------[ Slowing down ]-------*/
phy_speed_x = max(min(phy_speed_x, maxXSpeed), -maxXSpeed);
isMoving = false;

/*--[ Changing sprite direction and speed] --*/
if (phy_speed_x &gt; 0.1 || phy_speed_x &lt; -0.1) {
   if(sprite_index != sBobWalking &amp;&amp; !isFighting) {
       sprite_index = sBobWalking;
   }
   walkSpeed = phy_speed_x / 10;
   
   if(image_xscale == BOB_SCALE) {
        image_speed = walkSpeed;
   } else {
        image_speed = -walkSpeed;
   }
   
   isMoving = true;
} else {
    //If sprite has not already been set and is not firing &gt; Set image_speed + set sprite
    if(sprite_index != sBobIdle &amp;&amp; !isFighting) {
        sprite_index = sBobIdle;
        image_speed = defaultSpeed;
    } else if (isShooting) {
        image_speed = defaultSpeed*3;
    }
    isMoving = false;
}

/*------[ Jumping! ]------*/
if(keyboard_check_released(ord('Z')) &amp;&amp; jumpsLeft &gt; 0) {
    jumpsLeft--;
    phy_linear_velocity_y = -jumpPower;
    show_debug_message("JumpsLeft=" + string(jumpsLeft));
}
if (physics_test_overlap(x, y, 0, oCollisionBase) &amp;&amp; phy_linear_velocity_y &lt; 0.1) {
    jumpsLeft = maxJumps;
}

/*------[ Falling is bad ]------*/

/*if(phy_speed_y &gt; 1.2){
    controls = false;
    if(sprite_index != sBobWalking) {
        sprite_index = sBobFalling;
    }
} else {
    if(instance_number(oDialog) == 0) {
        controls = true;
    }
}*/

/*-------[ Moving ]-------*/
if (controls) {
    if keyboard_check(ord('D')) {
        if (!isFighting) {
            image_xscale = BOB_SCALE;
        }
        //image_speed = walkSpeed;
        physics_apply_force(x,y,moveSpeed,-100);
    }
    if keyboard_check(ord('Q')) {
        if (!isFighting) {
            image_xscale = -BOB_SCALE;
        }
        //image_speed = -walkSpeed;
        physics_apply_force(x,y,-moveSpeed,-100);
    }
}
/*-------[ Collision detection ]-------*/
if(place_meeting(x, y, oSlimBullet)) {
    with(instance_nearest(x, y, oSlimBullet)) {
        instance_destroy();
    }
    if(recoveryTimeCooldown &lt;= 0) {
        recoveryTimeCooldown = recoveryTimeMaxCooldown;
        
        playerHealth -= global.slimBulletDamage;
        if(playerHealth &lt;= 0) {
            playerHealth = 0;
        }
    }
}
/*-------[ Recovery Time ]-------*/
if(recoveryTimeCooldown &gt;= 0) {
    recoveryTimeCooldown-=(delta_time/1000); // delta_time is in microseconds
}

/*-------[ Shooting ]-------*/
if(shootingCooldown &gt;= 0) {
    shootingCooldown-=(delta_time/1000); // delta_time is in microseconds
}
/* Need to simplify */
if (controls) {
    if(playerAmmo[0] &gt; 0) {
        //Bullet X spawn position
        bulletX = 0;
        //Bullet Y spawn position
        bulletY = 0;
        //Bullet spawn direction
        bulletXspeed = 0;
        bulletYspeed = 0;
    
        //Switch sprite xscale depending on key and setting isFiring
        if keyboard_check(vk_left) {
            isShooting = true;
            isFighting = true;
            if (image_xscale != -BOB_SCALE) {
               image_xscale = -BOB_SCALE;
            }
        } else if keyboard_check(vk_right) {
            isShooting = true;
            isFighting = true;
            if (image_xscale != BOB_SCALE) {
               image_xscale = BOB_SCALE;
            }
        } else if keyboard_check(vk_up) {
            isShooting = true;
            isFighting = true;
        } else {
            // Not pressing any keys &amp;gt; isFiring = false
            isShooting = false;
            isFighting = false;
        }
        
        //Up Left
        if keyboard_check(vk_left) &amp;&amp; keyboard_check(vk_up) {
            if(isMoving)
            {
                if (sprite_index != sBobWalkingFiringUpward) {
                    sprite_index = sBobWalkingFiringUpward;
                }
            } else {
                if (sprite_index != sBobIdleFiringUpward) {
                    sprite_index = sBobIdleFiringUpward;
                }
            }
            
            //Angle 135
            bulletX = -16;
            bulletY = -24;
            bulletXspeed = -bulletSpeed;
            bulletYspeed = -bulletSpeed*0.5;
        } else if keyboard_check(vk_right) &amp;&amp; keyboard_check(vk_up) {
        //Angle 45
            if(isMoving)
            {
                if (sprite_index != sBobWalkingFiringUpward) {
                    sprite_index = sBobWalkingFiringUpward;
                }
            } else {
                if (sprite_index != sBobIdleFiringUpward) {
                    sprite_index = sBobIdleFiringUpward;
                    
                }
            }
        
            bulletX = 16;
            bulletY = -24;
            bulletXspeed = bulletSpeed;
            bulletYspeed = -bulletSpeed*0.5;
        } else if keyboard_check(vk_left) {
        //Angle 180
            if(isMoving)
            {
                if (sprite_index != sBobWalkingFiring) {
                    sprite_index = sBobWalkingFiring;
                }
            } else {
                if (sprite_index != sBobIdleFiring) {
                    sprite_index = sBobIdleFiring;
                }
            }
        
            bulletX = -24;
            bulletY = 0;
            bulletXspeed = -bulletSpeed;
            bulletYspeed = 0;
            
        } else if keyboard_check(vk_right) {
        //Angle 0
            if(isMoving)
            {
                if (sprite_index != sBobWalkingFiring) {
                    sprite_index = sBobWalkingFiring;
                }
            } else {
                if (sprite_index != sBobIdleFiring) {
                    sprite_index = sBobIdleFiring;
                }
            }
            bulletX = 24;
            bulletY = 0;
            bulletXspeed = bulletSpeed;
            bulletYspeed = 0;
        } else if keyboard_check(vk_up) {
        //Angle 90
            if(isMoving)
            {
                if (sprite_index != sBobWalkingFiringUp) {
                    sprite_index = sBobWalkingFiringUp;
                }
            } else {
                if (sprite_index != sBobIdleFiringUp) {
                    sprite_index = sBobIdleFiringUp;
                }
            }
            bulletX = 0;
            bulletY = -32;
            bulletDir = 90;
            bulletXspeed = 0 + phy_speed_x;
            bulletYspeed = -bulletSpeed;
        }
        
        //Shoot the bullet !
        if(isShooting) {
            if(shootingCooldown &lt;= 0) {
                var inst = instance_create(x+bulletX, y+bulletY, oBullet);
                playerAmmo[0]--;
                inst.phy_bullet = true;
                inst.phy_speed_x = bulletXspeed;
                inst.phy_speed_y = bulletYspeed;
    
                shootingCooldown = fullShootingCooldown;
            }
        }
    //Doesn't have ammo &gt; Punch
    } else if(!inPunch) {
        if keyboard_check_released(vk_left) {
            isFighting = true;
            if (image_xscale != -BOB_SCALE) {
                image_xscale = -BOB_SCALE;
            }
            if(irandom(1) == 0) {
                sprite_index = sBobFight1;
            } else {
                sprite_index = sBobFight2;
            }
            inPunch = true;
            
            //show_debug_message("Test");
            collision_object = collision_rectangle(x-16,y+16,x-32,y+-16, oSlimMiB, false, true);
            if(collision_object != noone)/*|| place_meeting(x-16, y, oBigMiB)*/{
            
                currentX = view_xview[0];
                currentRandomX = irandom(64)-32;
                global.stopTime = true;
                physics_pause_enable(true);
                inTruePunch = true;
                
                with (collision_object) {
                    punched = true;
                }
            }
        } else if keyboard_check_released(vk_right) {
            
            isFighting = true;
            if (image_xscale != BOB_SCALE) {
                image_xscale = BOB_SCALE;
            }
            if(irandom(1) == 0) {
                sprite_index = sBobFight1;
            } else {
                sprite_index = sBobFight2;
            }
            inPunch = true;
            
            collision_object = collision_rectangle(x+16,y+16,x+32,y+-16, oSlimMiB, false, true);
            if(collision_object != noone)/*|| place_meeting(x-16, y, oBigMiB)*/{
                
                currentX = view_xview[0];
                currentRandomX = irandom(64)-32;
                global.stopTime = true;
                physics_pause_enable(true);
                inTruePunch = true;
                
                with (collision_object) {
                    punched = true;
                }
            }
        }
    }
}

// Code to stick Bob to the right side of the viewPort
/*follow = false;
startingPoint = 0
movingValue = -1

if (bobDirection == 1) {
    if (view_xview[0] &gt; x + (sprite_width/2) - 0.70 * view_wview[0]){
        follow = false;
        view_xview[0] += bobSpeed * 5;
    } else if (view_xview[0] + x + (sprite_width/2) &gt;= view_xview[0] + 0.30 * view_wview[0]) {
        follow = true;
    }
} else {
    follow = false;
}

if (follow) {
    if (bobDirection == 1) { 
        viewPos = x + (sprite_width/2) - 0.30 * view_wview[0]
        if (viewPos + view_wview[0] &gt; room_width) {
            viewPos = room_width - view_wview[0];        
        }
        view_xview[0] = viewPos;
    }
}*/
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="4" ename="oCollisionBase">
      <action>
        <libid>1</libid>
        <id>605</id>
        <kind>0</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>0</useapplyto>
        <exetype>0</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>Fuck you Baltimore</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>//jumpsLeft = maxJumps;
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="10" enumb="32">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>//Setting randoms on button press
if(!inPunch) {
    currentX = view_xview[0];
    currentRandomX = irandom(64)-32;
    
    //show_debug_message(string(currentX)+","+string(currentY));
    //show_debug_message(string(currentRandomX)+","+string(currentRandomY));
    
    global.stopTime = true;
    physics_pause_enable(true);
    
    inPunch = true;
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
  </events>
  <PhysicsObject>-1</PhysicsObject>
  <PhysicsObjectSensor>0</PhysicsObjectSensor>
  <PhysicsObjectShape>1</PhysicsObjectShape>
  <PhysicsObjectDensity>1</PhysicsObjectDensity>
  <PhysicsObjectRestitution>0</PhysicsObjectRestitution>
  <PhysicsObjectGroup>0</PhysicsObjectGroup>
  <PhysicsObjectLinearDamping>1</PhysicsObjectLinearDamping>
  <PhysicsObjectAngularDamping>0.100000001490116</PhysicsObjectAngularDamping>
  <PhysicsObjectFriction>0.100000001490116</PhysicsObjectFriction>
  <PhysicsObjectAwake>-1</PhysicsObjectAwake>
  <PhysicsObjectKinematic>0</PhysicsObjectKinematic>
  <PhysicsShapePoints>
    <point>5,4</point>
    <point>26,4</point>
    <point>26,32</point>
    <point>5,32</point>
  </PhysicsShapePoints>
</object>
